package com.qitianzhen.skradio.ui.index

import android.content.Context
import android.content.Intent
import android.view.LayoutInflater
import android.view.View
import android.view.ViewGroup
import android.widget.ImageView
import androidx.cardview.widget.CardView
import androidx.recyclerview.widget.RecyclerView
import com.bumptech.glide.Glide
import com.bumptech.glide.load.resource.bitmap.RoundedCorners
import com.bumptech.glide.request.RequestOptions
import com.qitianzhen.skradio.R
import com.qitianzhen.skradio.data.Banner
import com.qitianzhen.skradio.data.IndexDataResult
import com.qitianzhen.skradio.data.MusicMenu
import com.qitianzhen.skradio.data.VideoAlbum
import com.qitianzhen.skradio.entity.CategoryMenu
import com.qitianzhen.skradio.ui.featured.FeaturedVideoActivity
import com.qitianzhen.skradio.ui.featured.VideoPlayerActivity
import com.qitianzhen.skradio.ui.music.MusicListActivity
import com.qitianzhen.skradio.ui.music.MusicListDetailActivity
import com.qitianzhen.skradio.ui.okya.lesson.OkyaActivity
import com.qitianzhen.skradio.ui.qtz.QtzMusicActivity
import com.qitianzhen.skradio.utils.dp2px
import com.qitianzhen.skradio.utils.getTextRes
import com.qitianzhen.skradio.widget.EnTextView
import kotlinx.android.synthetic.main.item_index_banner.view.*


/**
 * @Author CoderPig
 * @Desc: 首页Adapter
 * @CreateDate: Create in 2020-01-16 14:39
 */
class IndexAdapter(var context: Context)  : RecyclerView.Adapter<RecyclerView.ViewHolder>()  {
    companion object {
        private const val BANNER_ITEM = 0    // Banner
        private const val QZT_ITEM = 1    // 七田真专区
        private const val GROWTH_ITEM = 2    // 成长频道
        private const val OKYA_ITEM = 3    // 成长频道
        private const val VIDEO_ITEM = 4    // 精彩视频
    }

    private var mData: IndexDataResult = IndexDataResult(null,null,null,null, null, "","")
    private var currentType = BANNER_ITEM    // 当前Item

    fun refresh(data: IndexDataResult) {
        mData = data
        notifyDataSetChanged()
    }

    override fun onCreateViewHolder(parent: ViewGroup, viewType: Int): RecyclerView.ViewHolder {
        return when(viewType) {
            QZT_ITEM -> QtzViewHolder(LayoutInflater.from(context).inflate(R.layout.item_index_qtz, parent, false))
            GROWTH_ITEM -> GrowthViewHolder(LayoutInflater.from(context).inflate(R.layout.item_index_growth, parent, false))
            OKYA_ITEM -> OKYAViewHolder(LayoutInflater.from(context).inflate(R.layout.item_index_okya, parent, false))
            VIDEO_ITEM -> VideoViewHolder(LayoutInflater.from(context).inflate(R.layout.item_index_video, parent, false))
            else -> BannerViewHolder(LayoutInflater.from(context).inflate(R.layout.item_index_banner, parent, false))
        }
    }

    override fun onBindViewHolder(holder: RecyclerView.ViewHolder, position: Int) {
        when(position) {
            BANNER_ITEM -> { mData.banners?.let { (holder as BannerViewHolder).bind(it) } }
            QZT_ITEM -> { mData.tpiMusicMenuRes?.let { (holder as QtzViewHolder).bind(mData.tpiImageUrl) } }
            GROWTH_ITEM -> { mData.musicMenuRes?.let { (holder as GrowthViewHolder).bind(it) } }
            OKYA_ITEM -> {  (holder as OKYAViewHolder).bind(mData.okyaManageImageUrl)  }
            VIDEO_ITEM -> { mData.videoAlbums?.let { (holder as VideoViewHolder).bind(it) } }
        }
    }

    override fun getItemViewType(position: Int): Int {
        when(position) {
            BANNER_ITEM -> currentType = BANNER_ITEM
            QZT_ITEM -> currentType = QZT_ITEM
            GROWTH_ITEM -> currentType = GROWTH_ITEM
            OKYA_ITEM -> currentType = OKYA_ITEM
            VIDEO_ITEM -> currentType = VIDEO_ITEM
        }
        return currentType
    }

    override fun getItemCount(): Int = 5

    inner class BannerViewHolder(view: View): RecyclerView.ViewHolder(view) {
        private val iv_banner = view.iv_banner

        fun bind(data: ArrayList<Banner>) {
            if(data.size > 0) {
                Glide.with(context).load(data[0].imageUrl)
                    .apply(RequestOptions.bitmapTransform(RoundedCorners(dp2px(24.0f))))
                    .into(iv_banner)
                iv_banner.setOnClickListener {
                    val intent = Intent(context, BannerDetailActivity::class.java)
                    intent.putExtra("detailImageUrls", data[0].detailImageUrls)
                    context.startActivity(intent)
                }
            }
        }
    }

    inner class QtzViewHolder(view: View): RecyclerView.ViewHolder(view) {
        private val iv_cover = view.findViewById<ImageView>(R.id.iv_cover)
        private val iv_more_right = view.findViewById<ImageView>(R.id.iv_more_right)
        private val tv_title = view.findViewById<EnTextView>(R.id.tv_title)
        private val tv_sub_title = view.findViewById<EnTextView>(R.id.tv_sub_title)

        fun bind(cover: String) {
            tv_title.text = "七田真专区"
            tv_sub_title.text = mData.subTitles?.TPI_MUSIC_MENU_SUBTITLE
            Glide.with(context).load(cover).into(iv_cover)
            iv_more_right.setOnClickListener {
                context.startActivity(Intent(context, QtzMusicActivity::class.java))
            }
            iv_cover.setOnClickListener {
                context.startActivity(Intent(context, QtzMusicActivity::class.java))
            }
        }
    }

    inner class GrowthViewHolder(view: View): RecyclerView.ViewHolder(view) {
        private val tv_title = view.findViewById<EnTextView>(R.id.tv_title)
        private val tv_sub_title = view.findViewById<EnTextView>(R.id.tv_sub_title)
        private val cv_first = view.findViewById<CardView>(R.id.cv_first)
        private val iv_first_cover = view.findViewById<ImageView>(R.id.iv_first_cover)
        private val tv_first_title = view.findViewById<EnTextView>(R.id.tv_first_title)
        private val tv_first_desc = view.findViewById<EnTextView>(R.id.tv_first_desc)
        private val iv_first_vip_tag = view.findViewById<ImageView>(R.id.iv_first_vip_tag)
        private val cv_second = view.findViewById<CardView>(R.id.cv_second)
        private val iv_second_cover = view.findViewById<ImageView>(R.id.iv_second_cover)
        private val tv_second_title = view.findViewById<EnTextView>(R.id.tv_second_title)
        private val tv_second_desc = view.findViewById<EnTextView>(R.id.tv_second_desc)
        private val iv_second_vip_tag = view.findViewById<ImageView>(R.id.iv_second_vip_tag)
        private val cv_third = view.findViewById<CardView>(R.id.cv_third)
        private val iv_third_cover = view.findViewById<ImageView>(R.id.iv_third_cover)
        private val tv_third_title = view.findViewById<EnTextView>(R.id.tv_third_title)
        private val tv_third_desc = view.findViewById<EnTextView>(R.id.tv_third_desc)
        private val iv_third_vip_tag = view.findViewById<ImageView>(R.id.iv_third_vip_tag)
        private val iv_more_right = view.findViewById<ImageView>(R.id.iv_more_right)


        fun bind(data: ArrayList<MusicMenu>) {
            tv_title.text = "成长歌单"
            tv_sub_title.text = mData.subTitles?.RECOMMEND_MUSIC_MENU_SUBTITLE
            iv_more_right.setOnClickListener {
                context.startActivity(Intent(context, MusicListActivity::class.java))
            }
            val dataSize = data.size
            cv_first.visibility = View.INVISIBLE
            cv_second.visibility = View.INVISIBLE
            cv_third.visibility = View.INVISIBLE
            if(dataSize >= 1) {
                val musicMenu1 = data[0]
                Glide.with(context).load(musicMenu1.coverUrl).into(iv_first_cover)
                tv_first_title.text = musicMenu1.title
                tv_first_desc.text = musicMenu1.subTitle
                cv_first.visibility = View.VISIBLE
                iv_first_vip_tag.visibility = if(musicMenu1.vipState == 1) View.VISIBLE else View.INVISIBLE
                cv_first.setOnClickListener {
                    val intent = Intent(context, MusicListDetailActivity::class.java)
                    val categoryMenu = CategoryMenu(
                        musicMenu1.musicMenuId, musicMenu1.categoryId, musicMenu1.menuType, musicMenu1.coverUrl,
                        musicMenu1.title, musicMenu1.subTitle, musicMenu1.songsCount, musicMenu1.sequence, musicMenu1.vipState,
                        musicMenu1.loginState, musicMenu1.publishState, musicMenu1.description, musicMenu1.heatLevel)
                    intent.putExtra("categoryMenu", categoryMenu)
                    context.startActivity(intent)
                }
                if(dataSize >= 2) {
                    val musicMenu2 = data[1]
                    Glide.with(context).load(musicMenu2.coverUrl).into(iv_second_cover)
                    tv_second_title.text = musicMenu2.title
                    tv_second_desc.text = musicMenu2.subTitle
                    cv_second.visibility = View.VISIBLE
                    iv_second_vip_tag.visibility = if(musicMenu2.vipState == 1) View.VISIBLE else View.INVISIBLE
                    cv_second.setOnClickListener {
                        val intent = Intent(context, MusicListDetailActivity::class.java)
                        val categoryMenu = CategoryMenu(
                            musicMenu2.musicMenuId, musicMenu2.categoryId, musicMenu2.menuType, musicMenu2.coverUrl,
                            musicMenu2.title, musicMenu2.subTitle, musicMenu2.songsCount, musicMenu2.sequence, musicMenu2.vipState,
                            musicMenu2.loginState, musicMenu2.publishState, musicMenu2.description, musicMenu2.heatLevel)
                        intent.putExtra("categoryMenu", categoryMenu)
                        context.startActivity(intent)
                    }
                    if(dataSize >= 3) {
                        val musicMenu3 = data[2]
                        Glide.with(context).load(musicMenu3.coverUrl).into(iv_third_cover)
                        tv_third_title.text = musicMenu3.title
                        tv_third_desc.text = musicMenu3.subTitle
                        cv_third.visibility = View.VISIBLE
                        iv_third_vip_tag.visibility = if(musicMenu3.vipState == 1) View.VISIBLE else View.INVISIBLE
                        cv_third.setOnClickListener {
                            val intent = Intent(context, MusicListDetailActivity::class.java)
                            val categoryMenu = CategoryMenu(
                                musicMenu3.musicMenuId, musicMenu3.categoryId, musicMenu3.menuType, musicMenu3.coverUrl,
                                musicMenu3.title, musicMenu3.subTitle, musicMenu3.songsCount, musicMenu3.sequence, musicMenu3.vipState,
                                musicMenu3.loginState, musicMenu3.publishState, musicMenu3.description, musicMenu3.heatLevel)
                            intent.putExtra("categoryMenu", categoryMenu)
                            context.startActivity(intent)
                        }
                    }
                }
            }

        }
    }

    inner class OKYAViewHolder(view: View): RecyclerView.ViewHolder(view) {
        private val iv_cover = view.findViewById<ImageView>(R.id.iv_cover)
        private val iv_more_right = view.findViewById<ImageView>(R.id.iv_more_right)
        private val tv_title = view.findViewById<EnTextView>(R.id.tv_title)
        private val tv_sub_title = view.findViewById<EnTextView>(R.id.tv_sub_title)

        fun bind(cover: String) {
            Glide.with(context).load(cover).into(iv_cover)
            tv_title.text = getTextRes(R.string.okya_lesson_title)
            tv_sub_title.text = mData.subTitles?.TPI_OKYA_MANAGE_SUBTITLE
            iv_more_right.setOnClickListener {
                context.startActivity(Intent(context, OkyaActivity::class.java))
            }
            iv_cover.setOnClickListener {
                context.startActivity(Intent(context, OkyaActivity::class.java))
            }
        }
    }

    inner class VideoViewHolder(view: View): RecyclerView.ViewHolder(view) {
        private val tv_title = view.findViewById<EnTextView>(R.id.tv_title)
        private val tv_sub_title = view.findViewById<EnTextView>(R.id.tv_sub_title)
        private val cv_first = view.findViewById<CardView>(R.id.cv_first)
        private val iv_first_cover = view.findViewById<ImageView>(R.id.iv_first_cover)
        private val tv_first_title = view.findViewById<EnTextView>(R.id.tv_first_title)
        private val tv_first_desc = view.findViewById<EnTextView>(R.id.tv_first_desc)
        private val iv_first_vip_tag = view.findViewById<ImageView>(R.id.iv_first_vip_tag)
        private val cv_second = view.findViewById<CardView>(R.id.cv_second)
        private val iv_second_cover = view.findViewById<ImageView>(R.id.iv_second_cover)
        private val tv_second_title = view.findViewById<EnTextView>(R.id.tv_second_title)
        private val tv_second_desc = view.findViewById<EnTextView>(R.id.tv_second_desc)
        private val iv_second_vip_tag = view.findViewById<ImageView>(R.id.iv_second_vip_tag)
        private val cv_third = view.findViewById<CardView>(R.id.cv_third)
        private val iv_third_cover = view.findViewById<ImageView>(R.id.iv_third_cover)
        private val tv_third_title = view.findViewById<EnTextView>(R.id.tv_third_title)
        private val tv_third_desc = view.findViewById<EnTextView>(R.id.tv_third_desc)
        private val iv_third_vip_tag = view.findViewById<ImageView>(R.id.iv_third_vip_tag)
        private val iv_more_right = view.findViewById<ImageView>(R.id.iv_more_right)

        fun bind(data: ArrayList<VideoAlbum>) {
            tv_title.text = "精彩视频"
            tv_sub_title.text = mData.subTitles?.WONDERFUL_VIDEO_SUBTITLE
            iv_more_right.setOnClickListener {
                context.startActivity(Intent(context, FeaturedVideoActivity::class.java))
            }
            val dataSize = data.size
            cv_first.visibility = View.INVISIBLE
            cv_second.visibility = View.INVISIBLE
            cv_third.visibility = View.INVISIBLE
            if(dataSize >= 1) {
                val data1 = data[0]
                Glide.with(context).load(data1.coverUrl).into(iv_first_cover)
                tv_first_title.text = data1.title
                tv_first_desc.text = data1.subTitle
                cv_first.visibility = View.VISIBLE
                iv_first_vip_tag.visibility = if(data1.vipState == 1) View.VISIBLE else View.INVISIBLE
                cv_first.setOnClickListener {
                    val intent = Intent(context, VideoPlayerActivity::class.java)
                    intent.putExtra("videoAlbumId", data1.videoAlbumId)
                    context.startActivity(intent)
                }
                if(dataSize >= 2) {
                    val data2 = data[1]
                    Glide.with(context).load(data2.coverUrl).into(iv_second_cover)
                    tv_second_title.text = data2.title
                    tv_second_desc.text = data2.subTitle
                    cv_second.visibility = View.VISIBLE
                    iv_second_vip_tag.visibility = if(data2.vipState == 1) View.VISIBLE else View.INVISIBLE
                    cv_second.setOnClickListener {
                        val intent = Intent(context, VideoPlayerActivity::class.java)
                        intent.putExtra("videoAlbumId", data2.videoAlbumId)
                        context.startActivity(intent)
                    }
                    if(dataSize >= 3) {
                        val data3 = data[2]
                        Glide.with(context).load(data3.coverUrl).into(iv_third_cover)
                        tv_third_title.text = data3.title
                        tv_third_desc.text = data3.subTitle
                        cv_third.visibility = View.VISIBLE
                        iv_third_vip_tag.visibility = if(data3.vipState == 1) View.VISIBLE else View.INVISIBLE
                        cv_third.setOnClickListener {
                            val intent = Intent(context, VideoPlayerActivity::class.java)
                            intent.putExtra("videoAlbumId", data3.videoAlbumId)
                            context.startActivity(intent)
                        }
                    }
                }
            }
        }
    }
}
